{% load i18n static common_utils %}
{% load totalsum %}

{% if result_hidden_fields %}
	<div class="hiddenfields">{# DIV for HTML validation #}
		{% for item in result_hidden_fields %}
			{{ item }}
		{% endfor %}
	</div>
{% endif %}
{% if results %}
	<div class="results">
		<table id="result_list" class="table table-hover table-condensed">
			<thead>
				<tr>
					{% for header in result_headers %}
						<th scope="col" {{ header.class_attrib }}>
						    {% if header.sortable %}
							    {% if header.sort_priority > 0 %}
							        <div class="sortoptions">
								       <a class="sortremove" href="{{ header.url_remove }}" title="{% trans "Remove from sorting" %}"></a>
										{% if num_sorted_fields > 1 %}
											<span class="sortpriority" title="{% blocktrans with priority_number=header.sort_priority %}Sorting priority: {{ priority_number }}{% endblocktrans %}">
												{{ header.sort_priority }}
											</span>
										{% endif %}
										<a href="{{ header.url_toggle }}" class="toggle {% if header.ascending %}ascending{% else %}descending{% endif %}" title="{% trans "Toggle sorting" %}"></a>
									</div>
								{% endif %}
							{% endif %}
							<div class="text">
								{% if header.sortable %}
									<a href="{{ header.url_primary }}">{{ header.text|capfirst }}</a>
								{% else %}
									<span>{{ header.text|capfirst }}</span>
								{% endif %}
							</div>
							<div class="clear"></div>
						</th>
					{% endfor %}
				</tr>
			</thead>
			<tbody>
                            <tr class="totals">
                                  {% for header in result_headers %}
                                    {% with header.text as header_text %}
                                        <td>{% if totals|get_total:header_text != '' %}
                                          {{ totals|get_total:header_text }} {{ unit_of_measure|safe }}
                                        {% endif %}
                                      </td>
                                    {% endwith %}
                                  {% endfor %}
                                </tr>
				{% for result in results %}
					{% if result.form.non_field_errors %}
						<tr>
							<td colspan="{{ result|length }}">{{ result.form.non_field_errors }}</td>
						</tr>
					{% endif %}
					<tr class="{{ result.result.row_classes }} {% cycle 'row1' 'row2' %}">
						{% for item in result %}
							{{ item }}
						{% endfor %}
					</tr>
					{% if cl.list_details_template %}
						<tr class="details collapse" id="div_{{ result.result.pk }}">
							<td colspan="{{ result|length }}">
								    {% include cl.list_details_template with current=result.result %}
							</td>
						</tr>
					{% endif %}
				{% endfor %}
                                {% if pagination_required %}
                                <tr class="totals">
                                  {% for header in result_headers %}
                                    {% with header.text as header_text %}
                                      <td>
                                      {% if totals|get_total:header_text != '' %}
                                        <a href="?all=">...</a>
                                      {% endif %}
                                      </td>
                                    {% endwith %}
                                  {% endfor %}
                                </tr>
                                {% endif%}
                                <tr class="totals">
                                  {% for header in result_headers %}
                                    {% with header.text as header_text %}
                                        <td>{% if totals|get_total:header_text != '' %}
                                          {{ totals|get_total:header_text }} {{ unit_of_measure|safe }}
                                        {% endif %}
                                      </td>
                                    {% endwith %}
                                  {% endfor %}
                                </tr>
			</tbody>
		</table>
	</div>
{% endif %}
